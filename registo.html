<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registe-se</title>
<link rel="stylesheet" href="css/login.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<h2>Registe-se</h2>

<input type="text" id="username" placeholder="Nome"><br><br>
<input type="email" id="email" placeholder="Email"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>
<input type="text" id="contacto" placeholder="Contacto"><br><br>

<select id="tpUser">
    <option value="">Escolha o tipo</option>
</select><br><br>

<button onclick="registaUser()">Criar Conta</button>

<script>
$(document).ready(function(){
    // Preenche o select com os tipos da base
    $.getJSON('getTipos.php', function(tipos){
        tipos.forEach(tipo => {
            $('#tpUser').append(`<option value="${tipo.ID_TipoUtilizador}">${tipo.Tipo}</option>`);
        });
    });
});

function registaUser(){
    const nome = $('#username').val();
    const email = $('#email').val();
    const password = $('#password').val();
    const contacto = $('#contacto').val();
    const tipo = $('#tpUser').val();

    if(!nome || !email || !password || !tipo){
        Swal.fire('Erro', 'Preencha todos os campos obrigatÃ³rios!', 'error');
        return;
    }

    $.ajax({
    url: 'registar.php',
    type: 'POST',
    contentType: 'application/json',
    data: JSON.stringify({nome, email, password, contacto, tipo}),
    success: function(res){
        if(res.status === 'success'){

            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });

            Toast.fire({
                icon: "success",
                title: "Conta criada com sucesso!"
            }).then(() => {
                
                window.location.href = 'index.php';
            });

        } else {
            Swal.fire('Erro', res.msg, 'error');
        }
    },
    error: function(xhr){
        Swal.fire('Erro', 'Ocorreu um erro no servidor', 'error');
        console.log(xhr.responseText);
    }
});


}
</script>
</body>
</html>
