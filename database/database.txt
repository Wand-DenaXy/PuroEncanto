CREATE DATABASE IF NOT EXISTS PuroEncanto;
USE PuroEncanto;


CREATE TABLE TipoUtilizador (
    ID_TipoUtilizador INT PRIMARY KEY AUTO_INCREMENT,
    Tipo VARCHAR(50) NOT NULL
);

CREATE TABLE Utilizador (
    ID_Utilizador INT PRIMARY KEY AUTO_INCREMENT,
    Nome VARCHAR(100) NOT NULL,
    Email VARCHAR(100) NOT NULL,
    Password VARCHAR(255) NOT NULL,
    Contacto VARCHAR(15),
    ID_TipoUtilizador INT,
    FOREIGN KEY (ID_TipoUtilizador) REFERENCES TipoUtilizador(ID_TipoUtilizador)
        ON DELETE SET NULL
);


CREATE TABLE IF NOT EXISTS Fornecedores (
    ID_Fornecedor INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
	contacto VARCHAR(15),
    email VARCHAR(100),
    nif VARCHAR(100),
    morada VARCHAR(100) NOT NULL
);


CREATE TABLE Produtos (
    ID_Produto INT PRIMARY KEY AUTO_INCREMENT,
    Nome VARCHAR(100) NOT NULL,
    Preco DECIMAL(10,2) NOT NULL,
    Stock INT NOT NULL
);


CREATE TABLE Fornecimento (
    ID_Fornecimento INT PRIMARY KEY AUTO_INCREMENT,
    Data DATE NOT NULL,
    Quantidade INT NOT NULL,
    ID_Fornecedor INT,
    ID_Produto INT,
    FOREIGN KEY (ID_Fornecedor) REFERENCES Fornecedores(ID_Fornecedor)
        ON DELETE CASCADE,
    FOREIGN KEY (ID_Produto) REFERENCES Produtos(ID_Produto)
        ON DELETE CASCADE
);


CREATE TABLE Servicos (
    ID_Servico INT PRIMARY KEY AUTO_INCREMENT,
    Descricao VARCHAR(255) NOT NULL,
    Preco DECIMAL(10,2) NOT NULL
);


CREATE TABLE Venda (
    ID_Venda INT PRIMARY KEY AUTO_INCREMENT,
    Data DATE NOT NULL,
    ValorTotal DECIMAL(10,2) NOT NULL,
    ID_Utilizador INT,
    FOREIGN KEY (ID_Utilizador) REFERENCES Utilizador(ID_Utilizador)
        ON DELETE SET NULL
);


CREATE TABLE Rendimento (
    ID_Rendimento INT PRIMARY KEY AUTO_INCREMENT,
    Valor DECIMAL(10,2) NOT NULL,
    Data DATE NOT NULL,
    ID_Venda INT,
    FOREIGN KEY (ID_Venda) REFERENCES Venda(ID_Venda)
        ON DELETE SET NULL
);

CREATE TABLE Gastos (
    ID_Gasto INT PRIMARY KEY AUTO_INCREMENT,
    Descricao VARCHAR(255),
    Valor DECIMAL(10,2) NOT NULL,
    Data DATE NOT NULL
);

CREATE TABLE TiposEventos (
    ID_TipoEvento INT PRIMARY KEY AUTO_INCREMENT,
    Nome VARCHAR(100) NOT NULL
);

CREATE TABLE Eventos (
    ID_Evento INT PRIMARY KEY AUTO_INCREMENT,
    Nome VARCHAR(100) NOT NULL,
    Data DATE NOT NULL,
    Localizacao VARCHAR(100),
    ID_TipoEvento INT,
    FOREIGN KEY (ID_TipoEvento) REFERENCES TiposEventos(ID_TipoEvento)
        ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS ResumoFinanceiro (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    Ano INT NOT NULL,
    Mes INT NOT NULL,
    Rendimentos DECIMAL(10,2) NOT NULL,
    Gastos DECIMAL(10,2) NOT NULL
);

CREATE TABLE visitantes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ip VARCHAR(50),
    ultima_atividade DATETIME,
    total_visitas INT DEFAULT 1
);

CREATE TABLE visitas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ip VARCHAR(50),
    ultima_atividade TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS VendasServicos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    descricao VARCHAR(100) NOT NULL,
    total_vendas DECIMAL(10,2) NOT NULL
);


INSERT INTO TipoUtilizador (Tipo) VALUES 
('Administrador'), 
('Funcionário');

-- Utilizadores
INSERT INTO Utilizador (Nome, Email, Password, Contacto, ID_TipoUtilizador) VALUES
('Pedro Silva', 'pedro@email.com', 'senha123', '912345678', 1),
('Ana Costa', 'ana@email.com', 'senha456', '913456789', 2);


INSERT INTO Fornecedores (Nome, Contacto, Email, nif,Morada) VALUES
('Fornecedor A', '917654321', 'fornA@email.com', '232042837','Bairro da Casinha'),
('Fornecedor B', '918765432', 'fornB@email.com', '250825392','Fria Aleixo');


INSERT INTO Produtos (Nome, Preco, Stock) VALUES
('Relógio Clássico', 120.00, 15),
('Relógio Moderno', 180.50, 10);


INSERT INTO Fornecimento (Data, Quantidade, ID_Fornecedor, ID_Produto) VALUES
('2025-08-01', 5, 1, 1),
('2025-08-03', 3, 2, 2);


INSERT INTO Servicos (Descricao, Preco) VALUES
('Limpeza de relógio', 25.00),
('Reparação de bracelete', 40.00);

INSERT INTO Venda (Data, ValorTotal, ID_Utilizador) VALUES
('2025-08-05', 200.00, 1);


INSERT INTO Rendimento (Valor, Data, ID_Venda) VALUES
(200.00, '2025-08-05', 1);


INSERT INTO Gastos (Descricao, Valor, Data) VALUES
('Compra de material de limpeza', 35.00, '2025-08-02'),
('Publicidade online', 50.00, '2025-08-04');

INSERT INTO TiposEventos (Nome) VALUES
('Promoção'),
('Feira');

INSERT INTO Eventos (Nome, Data, Localizacao, ID_TipoEvento) VALUES
('Black Friday', '2025-11-29', 'Loja Principal', 1),
('Feira de Natal', '2025-12-10', 'Centro Comercial', 2);

INSERT INTO ResumoFinanceiro (Ano, Mes, Rendimentos, Gastos)
VALUES 
(2025, 4, 75292.00, 243.02), -- Janeiro (exemplo)
(2025, 5, 10000.00, 3000.00), -- Fevereiro (exemplo)
(2025, 6, 15000.00, 5000.00); -- Março (exemplo)


INSERT INTO VendasServicos (descricao, total_vendas) VALUES
('PE_Bolo', 4410),
('PE_Catering Serviço', 28200),
('PE_Decoração Serviço', 4300),
('PE_Insuflável Serviço', 2450),
('PE_Máq Pipocas Serviço', 9000);