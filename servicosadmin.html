<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puro Encanto - Vendas</title>
    
    <link rel="stylesheet" href="asset/css/servicosadmin.css">
    <link rel="stylesheet" href="asset/css/lib/datatables.css">
    <link rel="stylesheet" href="asset/css/lib/select2.css">
    <link rel="stylesheet" href="asset/css/lib/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <script src="asset/js/lib/jquery.js"></script>
    <script src="asset/js/lib/bootstrap.js"></script>
    <script src="asset/js/lib/datatables.js"></script>
    <script src="asset/js/lib/select2.js"></script>
    <script src="asset/js/lib/sweatalert.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>

    </style>
</head>

<body>
    <div class="sidebar">
        <a href="index.php" style="background-color: transparent;border-left: none;">
            <div class="logo">
                <img src="images/logos/PURO ENCANTO LOGO.png" alt="Puro Encanto">
                <p class="logotitulo">Puro Encanto</p>
            </div>
        </a>
        <a href="dashboard.php">
            <i class="bi bi-grid-fill"></i> Dashboard
        </a>
        <a href="gastoserendimentos.html">
            <i class="bi bi-cash-stack"></i> Gastos e Rendimentos
        </a>
        <a href="servicosadmin.html" class="active">
            <i class="bi bi-cart-fill"></i> Vendas
        </a>
        <a href="fornecedores.html">
            <i class="bi bi-truck"></i> Fornecedores
        </a>
        <a href="clientes.html">
            <i class="bi bi-people-fill"></i> Clientes
        </a>
        <a href="funcionario.html">
            <i class="bi bi-person-badge-fill"></i> Funcionários
        </a>
        <a href="calendario.html">
            <i class="bi bi-calendar3"></i> Calendário
        </a>
        <a href="economicofinanceiro.php">
            <i class="bi bi-graph-up-arrow"></i> Económico-Financeiro
        </a>
        
        <a href="perfilAdmin.php">
            <i class="bi bi-person-circle"></i> Perfil
        </a>
        <div class="time" id="time"></div>
    </div>

    <div class="content">
        <div class="page-header">
            <h2>
                <i class="bi bi-cart-check-fill"></i>
                Análise de Vendas
            </h2>
        </div>


        <div class="section-header">
            <h3>
                <i class="bi bi-graph-up-arrow"></i>
                Rendimentos de Serviços Trimestrais
            </h3>
        </div>

        <div class="chart-grid-single">
            <div class="chart-card primary">
                <h4>
                    <i class="bi bi-currency-euro"></i>
                    Evolução Mensal de Rendimentos
                    <span class="month-badge">Trimestral</span>
                </h4>
                <div class="chart-container">
                    <canvas id="graficoRendimentos"></canvas>
                </div>
            </div>
        </div>

        <!-- Seção: Serviços Mais Utilizados -->
        <div class="section-header">
            <h3>
                <i class="bi bi-bar-chart-fill"></i>
                Serviços Mais Utilizados por Mês
            </h3>
        </div>

        <div class="chart-grid">
            <div class="chart-card success">
                <h4>
                    <i class="bi bi-calendar-month"></i>
                    Abril
                    <span class="month-badge" style="background: linear-gradient(135deg, var(--success-color), #13855c);">04</span>
                </h4>
                <div class="chart-container">
                    <canvas id="graficoUtilizado"></canvas>
                </div>
            </div>

            <div class="chart-card warning">
                <h4>
                    <i class="bi bi-calendar-month"></i>
                    Maio
                    <span class="month-badge" style="background: linear-gradient(135deg, var(--warning-color), #d4a417);">05</span>
                </h4>
                <div class="chart-container">
                    <canvas id="graficoUtilizado2"></canvas>
                </div>
            </div>

            <div class="chart-card purple">
                <h4>
                    <i class="bi bi-calendar-month"></i>
                    Junho
                    <span class="month-badge" style="background: linear-gradient(135deg, var(--purple-color), #563d7c);">06</span>
                </h4>
                <div class="chart-container">
                    <canvas id="graficoUtilizado3"></canvas>
                </div>
            </div>
        </div>

    <script src="asset/js/vendas.js"></script>
    <script>
        function atualizarHora() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const elemento = document.getElementById('time');
            if (elemento) {
                elemento.textContent = now.toLocaleDateString('pt-PT', options);
            }
        }
        
        atualizarHora();
        setInterval(atualizarHora, 60000);

        // Carregar gráficos
        $(document).ready(function() {
            // Mostrar loading inicial
            showLoadingState();
            GraficoServico();
            getFornecedoresAbril();
            GraficoServicoUtilizadoAbril();
            GraficoServicoUtilizadoMaio();
            GraficoServicoUtilizadoJunho();
            setTimeout(() => {
                updateMiniStats();
            }, 1500);
        });

        function showLoadingState() {
            const charts = ['graficoRendimentos', 'graficoUtilizado', 'graficoUtilizado2', 'graficoUtilizado3'];
            charts.forEach(chartId => {
                const canvas = document.getElementById(chartId);
                if (canvas) {
                    const parent = canvas.parentElement;
                    parent.innerHTML = `
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Carregando dados...</div>
                        </div>
                    `;
                    // Restaurar canvas após loading
                    setTimeout(() => {
                        parent.innerHTML = `<canvas id="${chartId}"></canvas>`;
                    }, 500);
                }
            });
        }
    </script>
</body>
</html>